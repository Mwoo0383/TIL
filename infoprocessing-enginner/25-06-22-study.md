# 7단원 - SQL 응용

## 📌 트랜잭션

- 인가 받지 않은 사용자로부터 데이터를 보장하기 위해 DBMS가 가져야 하는 특성
- 하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위

## 📌 트랜잭션의 특성 - ACID
> - **원자성(Atomicity)**
: 트랜잭션을 구성하는 연산 전체가 모두 정상적으로 실행되거나 모두 취소되어야 하는 성질 (전체 성공 또는 실패)
> - **일관성(Consistency)**
: 시스템이 가지고 있는 고정 요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 하는 성질
> - **격리성 = 고립성(Isolation)**
: 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않아야 한다는 성질
> - **영속성(Durability)**
: 성공이 완료된 트랜잭션의 결과는 영속적으로 데이터베이스에 저장되어야 하는 성질

## 📌 TCL(Transaction Control Language)
> - **COMMIT**
> - **ROLLBACK**
> - **CHECKPOINT**

## 📌 데이터베이스 회복 기법 종류
> - **REDO**
: 데이터베이스가 비정상적으로 종료되었을 때 디스크에 저장된 로그를 분석하여 트랜잭션의 시작과 완료에 대한 기록이 있는 트랜잭션들의 작업을 재 작업하는 기법. 데이터베이스 내용 자체가 소낫ㅇ된 경우, 가장 최근의 복제본을 적재한 후 이후 일어난 변경만을 로그를 이용하여 재실행함으로써 데이터베이스를 복원하는 기법
> - **UNDO**
: 데이터베이스가 비정상적으로 종료되었을 때 디스크에 저장된 로그를 분석하여 트랜잭션의 시작은 있지만, 완료 기록이 없는 트랜잭션들이 작업한 변경 내용들을 모두 최소하는 기법. 데이터베이스 내용 자체는 손상되지 않았지만, 변경 중이거나 변경된 내용에 대한 신뢰성을 잃어버린 경우, 모든 변경 내용을 취소하여 복원하는 기법
> - **로그 기반 회복 기법**  
> 1.. 지연 갱신 회복 기법(Deferred Update)
: 트랜잭션이 완료되기 전까지 데이터베이스에 기록하지 않는 기법
> 2.. 즉각 갱신 회복 기법(Immediate Update)
: 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영하는 기법
> - **체크 포인트 회복 기법**
: 장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 쟁아 발생 이전의 상태로 복원시키는 회복 기법
> - **그림자 페이징 회복 기법**
: 데이터베이스 트랜잭션 수행 시 복제본을 생성하여 데이터베이스 장애 시 이를 이용해 복구하는 기법

## 📌 인덱스의 개념
검색 연산의 최적화를 위해 데이터베이스 내 값에 대한 주소 정보로 구성된 데이터 구조
> - **순차**
: 레코드들의 물리적 순서와 같게 순차적으로 저장
> - **인덱스**
: <키 값, 주소>의 쌍으로 구성
> - **해싱**
: 키 값을 해시 함수에 대입시켜 계산한 결과를 주소로 사용

## 📌 DDL(Data Definition Language)
데이터를 정의하는 언어로서 '데이터를 담는 그릇을 정의하는 언어'

### 1. DDL 대상
> - **도메인**
: 하나의 속성이 가질 수 있는 원자값들의 집합, 속성의 데이터 타입과 크기, 제약조건 등의 정보
> - **스키마**
: 데이터베이스 구조, 제약조건 등의 정보를 담고 있는 기본적인 구조
> **(a) 외부 스키마**
: 사용자나 개발자의 관점으로 필요로 하는 데이터베이스의 논리적 구조(사용자 뷰, 서브 스키마)
> **(b) 개념 스키마**
: 데이터베이스의 전체적인 논리적 구조로 전체적인 뷰를 나타냄. 개체 간의 관계, 제약 조건, 접근 권한, 무결성, 보안에 대해 정의
> **(c) 내부 스키마**
: 물리적 저장 장치의 관점에서 보는 데이터베이스 구조. 실제로 데이터베이스에 저장될 레코드의 형식을 정의하고 저장 데이터 항목의 표현 방법, 내부 레코드의 물리적 순서 등을 표현
> - **테이블**
> - **뷰**
> - **인덱스**

## 📌 DDL 명령어
> - **create**
> - **alter**
: alter table 테이블명 add(modify, drop column) 컬럼명;
> - **drop**
: cascade(참조테이블까지 제거), restrict(참조테이블 있으면 제거)
> - **truncate**

## 📌 DML 명령어
> - **select**
> - **insert**
> - **update**
> - **delete**

## 📌 DCL 명령어
> - **grant**
> - **revoke**

## 📌 다중행 연산자
> - **IN**
> - **ANY**
: 조건이 하나 이상 만족하면 참
> - **ALL**
: 조건을 모두 만족해야 참
> - **EXISTS**
: 만족하는 값이 하나라도 존재하면 참

## 📌 데이터 분석 함수 종류

### 1. 집계 함수
> - **count**
: null 미포함
> - **sum** 
> - **avg**
> - **max**
> - **min**
> - **stddev**
: 표준편차
> - **variance**
: 분산

### 2. 그룹 함수
> - **rollup**
> - **cube**
> - **grouping sets**

### 3. 윈도우 함수
> - **rank**
: 동일 순위 존재 시 후순위 패스(1 2 2 2 5 6)
> - **dense_rank**
: 동일 순위 존재 시에도 후순위 패스 x(1 2 2 2 3 4 5)
> - **row_number**
: 동일 순위 존재 시에도 연속 번호 부여(1 2 3 4 5 6 - 2위가 3개)

## 📌 절차형 SQL
> - **프로시저**
: 일련의 쿼리들을 마치 하나의 함수처럼 실행하기 위한 쿼리의 집합
> - **사용자 정의 함수**
> - **트리거**
: 이벤트 발생 시 관련 작업이 자동 수행

## 📌 옵티마이저
SQL을 가장 빠르고 효율적으로 수행할 최적의 처리경로를 생성해주는 DBMS 내부의 핵심엔진
> - **규칙기반 옵티마이저(RBO)**
: 통계 정보가 없는 상태에서 등록된 규칙에 따라 질의 실행 계획을 선택
> - **비용기반 옵티마이저(CBO)**
: 통계 정보로부터 모든 접근 경로를 고려한 질의 실행 계획을 선택